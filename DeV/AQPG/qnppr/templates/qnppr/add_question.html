{% extends 'qnppr/base_add_question.html' %}
{% load crispy_forms_tags %}

{% block content %}

    <div class="content-section" style="background: white; padding: 10px 20px; border: 1px solid #dddddd; border-radius: 3px;">
        <form method="POST" id="addSubjectForm" data-sem-url="{% url 'ajax_load_sem' %}" data-sub-url="{% url 'ajax_load_sub' %}" data-sub_klevel-url="{% url 'ajax_predi_klevel' %}" autocomplete="off" novalidate>
            {% csrf_token %}
            <fieldset class="form-group">
                <legend class="border-bottom mb-4">Add Your Question Here</legend>
                    <div class="form-row">
                        <div class="form-group col-md-6 mb-0">
                            {{ form_1.dept|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-6 mb-0">
                        {{ form_1.sem|as_crispy_field }}
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group col-md-8 mb-0">
                            {{ form_2.subject|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-4 mb-0">
                        {{ form_2.module|as_crispy_field }}
                        </div>
                    </div>
                    {{ form_2.desc|as_crispy_field }}
                    {{ form_2.fig|as_crispy_field }}

                    <div class="form-row">
                        <div class="form-group col-md-6 mb-0">
                            {{ form_2.klevel|as_crispy_field }}
                        </div>
                        <div class="form-group col-md-6 mb-0">
                        {{ form_2.mark|as_crispy_field }}
                        </div>
                    </div>
            </fieldset>
            <div class="form-group">
                <button class="btn btn-outline-info" type="submit">Add</button>
            </div>
        </form>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <!--<script>
    $(document).ready(function() {
      console.log($.ajax);
    });
  </script>-->
  <script>
    $("#id_dept").change(function () {
      var url = $("#addSubjectForm").attr("data-sem-url");
      var deptId = $(this).val();
      console.log(deptId)

      $.ajax({
        url: url,
        data: {
          'dept': deptId
        },
        success: function (data) {
          $("#id_sem").html(data);
        }
      });

    });

    $("#id_sem").change(function () {
      var url = $("#addSubjectForm").attr("data-sub-url");
      var semId = $(this).val();
      var deptId=$("#id_dept").val();
      console.log(deptId)

      $.ajax({
        url: url,
        data: {
          'dept': deptId,
            'sem': semId
        },
        success: function (data) {
          $("#id_subject").html(data);
        }
      });

    });

    $("#id_desc").focusout(function () {
      var url = $("#addSubjectForm").attr("data-sub_klevel-url");
      var qn = $(this).val();
      console.log(qn)

      $.ajax({
        url: url,
        data: {
          'qn': qn
        },
        success: function (data) {
            obj = JSON.parse(data);
            var t = obj.k;
            console.log(t)
            /*$('#id_klevel').val(t);*/
            $("#id_klevel").val(t);
          /*$("#id_mark").html(data);*/
        }
      });

    });
  </script>
       <!-- <div class="border-top pt-3">
            <small class="text-muted">
                Already Have An Account? <a class="ml-2" href="#">Sign In</a>
            </small>
        </div>-->
    </div>

{% endblock content %}